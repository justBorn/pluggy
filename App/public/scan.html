<html>
	<head>
		<meta charset="utf-8" />
		<title>jsQR Demo</title>
		<script src="./assets/js/jsqr.js"></script>
		<link
			href="https://fonts.googleapis.com/css?family=Ropa+Sans"
			rel="stylesheet"
		/>
		<!-- <style>
			body {
				font-family: "Ropa Sans", sans-serif;
				color: #333;
				max-width: 640px;
				margin: 0 auto;
				position: relative;
			}

			#githubLink {
				position: absolute;
				right: 0;
				top: 12px;
				color: #2d99ff;
			}

			h1 {
				margin: 10px 0;
				font-size: 40px;
			}

			#loadingMessage {
				text-align: center;
				padding: 40px;
				background-color: #eee;
			}

			#canvas {
				width: 100%;
			}

			#output {
				margin-top: 20px;
				background: #eee;
				padding: 10px;
				padding-bottom: 0;
			}

			#output div {
				padding-bottom: 10px;
				word-wrap: break-word;
			}

			#noQRFound {
				text-align: center;
			}
		</style> -->
		<meta charset="UTF-8" />
		<link rel="stylesheet" type="text/css" href="index.css" />
	</head>
	<body>
		<div class="navbar">
			<div class="curved-div upper">
				<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 199">
					<path
						fill="#4ac267"
						fill-opacity="1"
						d="M0,128L60,144C120,160,240,192,360,186.7C480,181,600,139,720,138.7C840,139,960,181,1080,186.7C1200,192,1320,160,1380,144L1440,128L1440,200L1380,200C1320,200,1200,200,1080,200C960,200,840,200,720,200C600,200,480,200,360,200C240,200,120,200,60,200L0,200Z"
					></path>
				</svg>
			</div>
			<div class="curved-div bottom">
				<h1>Ciao Alessandro,</h1>
				<h2>find your place to charge <img src="./assets/img/light.png" /></h2>
				<!-- <svg viewBox="0 0 1440 319">
				<path
					fill="#fff"
					fill-opacity="1"
					d="M0,32L48,80C96,128,192,224,288,224C384,224,480,128,576,90.7C672,53,768,75,864,96C960,117,1056,139,1152,149.3C1248,160,1344,160,1392,160L1440,160L1440,200L1392,200C1344,200,1248,200,1152,200C1056,200,960,200,864,200C768,200,672,200,576,200C480,200,384,200,288,200C192,200,96,200,48,200L0,200Z"
				></path>
			</svg> -->
			</div>
		</div>
		<div class="container">
			<!-- <h1>jsQR Demo</h1>
		<a id="githubLink" href="https://github.com/cozmo/jsQR"
			>View documentation on Github</a
		>
		<p>Pure JavaScript QR code decoding library.</p> -->
			<div id="loadingMessage">
				ðŸŽ¥ Unable to access video stream (please make sure you have a webcam
				enabled)
			</div>
			<canvas id="canvas" hidden></canvas>
			<div id="output" hidden>
				<div id="outputMessage">No QR code detected.</div>
				<div hidden><b>Data:</b> <span id="outputData"></span></div>
			</div>
		</div>

		<script>
			var video = document.createElement("video");
			var canvasElement = document.getElementById("canvas");
			var canvas = canvasElement.getContext("2d");
			var loadingMessage = document.getElementById("loadingMessage");
			var outputContainer = document.getElementById("output");
			var outputMessage = document.getElementById("outputMessage");
			var outputData = document.getElementById("outputData");

			function drawLine(begin, end, color) {
				canvas.beginPath();
				canvas.moveTo(begin.x, begin.y);
				canvas.lineTo(end.x, end.y);
				canvas.lineWidth = 4;
				canvas.strokeStyle = color;
				canvas.stroke();
			}

			// Use facingMode: environment to attemt to get the front camera on phones
			navigator.mediaDevices
				.getUserMedia({
					video: {
						facingMode: "environment",
						// height: { ideal: 1702 },
						aspectRatio: 9 / 16,
						// width: { ideal: 980 },
					},
				})
				.then(function (stream) {
					video.srcObject = stream;
					video.setAttribute("playsinline", true); // required to tell iOS safari we don't want fullscreen
					video.play();
					requestAnimationFrame(tick);
				});
			var i = 0;
			function tick() {
				i++;
				loadingMessage.innerText = "âŒ› Loading video...";
				if (video.readyState === video.HAVE_ENOUGH_DATA) {
					loadingMessage.hidden = true;
					canvasElement.hidden = false;
					outputContainer.hidden = false;

					canvasElement.height = 1702;
					canvasElement.width = 980;
					canvas.drawImage(
						video,
						0,
						0,
						canvasElement.width,
						canvasElement.height
					);
					var imageData = canvas.getImageData(
						0,
						0,
						canvasElement.width,
						canvasElement.height
					);
					if (i % 25 === 0) {
						var code = jsQR(imageData.data, imageData.width, imageData.height, {
							inversionAttempts: "dontInvert",
						});
						if (code) console.log(code.data);
					}

					// if (code) {
					// 	drawLine(
					// 		code.location.topLeftCorner,
					// 		code.location.topRightCorner,
					// 		"#FF3B58"
					// 	);
					// 	drawLine(
					// 		code.location.topRightCorner,
					// 		code.location.bottomRightCorner,
					// 		"#FF3B58"
					// 	);
					// 	drawLine(
					// 		code.location.bottomRightCorner,
					// 		code.location.bottomLeftCorner,
					// 		"#FF3B58"
					// 	);
					// 	drawLine(
					// 		code.location.bottomLeftCorner,
					// 		code.location.topLeftCorner,
					// 		"#FF3B58"
					// 	);
					// 	outputMessage.hidden = true;
					// 	outputData.parentElement.hidden = false;
					// } else {
					// 	outputMessage.hidden = false;
					// 	outputData.parentElement.hidden = true;
					// }
				}
				requestAnimationFrame(tick);
			}
		</script>
	</body>
</html>
